<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Rutas y Viajes - TransportePro</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 0;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header .logo { font-size: 1.5rem; font-weight: bold; }
        .btn-logout {
            background: rgba(255,255,255,0.2);
            border: 1px solid white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }
        .btn-logout:hover { background: rgba(255,255,255,0.3); }
        .container { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; }
        h2 { color: #333; margin-bottom: 1rem; border-bottom: 2px solid #667eea; padding-bottom: 0.5rem; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        table, th, td { border: 1px solid #ccc; }
        th, td { padding: 0.5rem; text-align: left; }
        .btn { padding: 0.5rem 1rem; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #5568d3; }
        .btn-delete { background: #e74c3c; }
        .btn-delete:hover { background: #c0392b; }
        .btn-edit { background: #f39c12; }
        .btn-edit:hover { background: #e67e22; }
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:1000; }
        .modal-content { background: white; padding: 2rem; border-radius: 10px; width: 90%; max-width: 600px; }
        .close-modal { float: right; cursor: pointer; font-size: 1.5rem; }
        form { display: flex; flex-direction: column; gap: 1rem; }
        input, select, datetime-local { padding: 0.5rem; border-radius: 5px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">üõ£Ô∏è Gesti√≥n de Rutas y Viajes - TransportePro</div>
        <button class="btn-logout" onclick="logout()">Cerrar Sesi√≥n</button>
    </div>

    <div class="container">
        <h2>Rutas</h2>
        <button class="btn" onclick="openModal('crearRuta')">Nueva Ruta</button>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Origen</th>
                    <th>Destino</th>
                    <th>Distancia (km)</th>
                    <th>Precio Base</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="rutasTable"></tbody>
        </table>

        <h2>Viajes Programados</h2>
        <button class="btn" onclick="openModal('crearViaje')">Nuevo Viaje</button>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Ruta</th>
                    <th>Veh√≠culo</th>
                    <th>Conductor</th>
                    <th>Fecha Salida</th>
                    <th>Fecha Llegada</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="viajesTable"></tbody>
        </table>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle"></h3>
            <form id="modalForm" onsubmit="saveItem(event)">
            </form>
        </div>
    </div>

    <script>
        // Datos de prueba simulando la DB
        let rutasData = [
            {id:1, origen:'Bogot√°', destino:'Medell√≠n', distancia:420.5, precio_base:120000, estado:'activa'},
            {id:2, origen:'Medell√≠n', destino:'Cali', distancia:415.0, precio_base:110000, estado:'activa'},
            {id:3, origen:'Bogot√°', destino:'Villavicencio', distancia:120.0, precio_base:35000, estado:'activa'}
        ];

        let viajesData = [
            {id:1, ruta:'Bogot√° - Medell√≠n', vehiculo:'ABC123', conductor:'Juan Rodr√≠guez', fecha_salida:'2025-01-20T08:00', fecha_llegada:'2025-01-20T15:00', estado:'finalizado'},
            {id:2, ruta:'Bogot√° - Villavicencio', vehiculo:'ABC123', conductor:'Juan Rodr√≠guez', fecha_salida:'2025-01-22T10:00', fecha_llegada:'2025-01-22T13:00', estado:'programado'},
            {id:3, ruta:'Medell√≠n - Cali', vehiculo:'FRT456', conductor:'Miguel D√≠az', fecha_salida:'2025-01-25T07:00', fecha_llegada:'2025-01-25T14:00', estado:'en-curso'}
        ];

        let editingItem = null;
        let editingType = null;

        function loadRutasTable() {
            const tbody = document.getElementById('rutasTable');
            tbody.innerHTML = rutasData.map(r => `
                <tr>
                    <td>${r.id}</td>
                    <td>${r.origen}</td>
                    <td>${r.destino}</td>
                    <td>${r.distancia}</td>
                    <td>${r.precio_base}</td>
                    <td>${r.estado}</td>
                    <td>
                        <button class="btn-edit" onclick="openModal('editarRuta', ${r.id})">Editar</button>
                        <button class="btn-delete" onclick="deleteItem('ruta', ${r.id})">Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        function loadViajesTable() {
            const tbody = document.getElementById('viajesTable');
            tbody.innerHTML = viajesData.map(v => `
                <tr>
                    <td>${v.id}</td>
                    <td>${v.ruta}</td>
                    <td>${v.vehiculo}</td>
                    <td>${v.conductor}</td>
                    <td>${v.fecha_salida}</td>
                    <td>${v.fecha_llegada}</td>
                    <td>${v.estado}</td>
                    <td>
                        <button class="btn-edit" onclick="openModal('editarViaje', ${v.id})">Editar</button>
                        <button class="btn-delete" onclick="deleteItem('viaje', ${v.id})">Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        function openModal(tipo, id=null) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('modalForm');
            modal.style.display = 'flex';
            form.innerHTML = '';
            editingItem = null;
            editingType = tipo;

            if(tipo === 'crearRuta' || tipo === 'editarRuta') {
                title.textContent = tipo==='crearRuta'?'Nueva Ruta':'Editar Ruta';
                let ruta = {origen:'', destino:'', distancia:'', precio_base:'', estado:'activa'};
                if(tipo==='editarRuta') ruta = rutasData.find(r => r.id===id);
                editingItem = ruta;

                form.innerHTML = `
                    <input type="text" name="origen" placeholder="Origen" value="${ruta.origen}" required>
                    <input type="text" name="destino" placeholder="Destino" value="${ruta.destino}" required>
                    <input type="number" step="0.1" name="distancia" placeholder="Distancia (km)" value="${ruta.distancia}" required>
                    <input type="number" name="precio_base" placeholder="Precio Base" value="${ruta.precio_base}" required>
                    <select name="estado" required>
                        <option value="activa" ${ruta.estado==='activa'?'selected':''}>Activa</option>
                        <option value="inactiva" ${ruta.estado==='inactiva'?'selected':''}>Inactiva</option>
                    </select>
                    <button class="btn" type="submit">${tipo==='crearRuta'?'Guardar':'Actualizar'}</button>
                `;
            }

            if(tipo === 'crearViaje' || tipo === 'editarViaje') {
                title.textContent = tipo==='crearViaje'?'Nuevo Viaje':'Editar Viaje';
                let viaje = {ruta:'', vehiculo:'', conductor:'', fecha_salida:'', fecha_llegada:'', estado:'programado'};
                if(tipo==='editarViaje') viaje = viajesData.find(v => v.id===id);
                editingItem = viaje;

                form.innerHTML = `
                    <input type="text" name="ruta" placeholder="Ruta" value="${viaje.ruta}" required>
                    <input type="text" name="vehiculo" placeholder="Veh√≠culo" value="${viaje.vehiculo}" required>
                    <input type="text" name="conductor" placeholder="Conductor" value="${viaje.conductor}" required>
                    <input type="datetime-local" name="fecha_salida" value="${viaje.fecha_salida}" required>
                    <input type="datetime-local" name="fecha_llegada" value="${viaje.fecha_llegada}" required>
                    <select name="estado" required>
                        <option value="programado" ${viaje.estado==='programado'?'selected':''}>Programado</option>
                        <option value="en-curso" ${viaje.estado==='en-curso'?'selected':''}>En Curso</option>
                        <option value="finalizado" ${viaje.estado==='finalizado'?'selected':''}>Finalizado</option>
                        <option value="cancelado" ${viaje.estado==='cancelado'?'selected':''}>Cancelado</option>
                    </select>
                    <button class="btn" type="submit">${tipo==='crearViaje'?'Guardar':'Actualizar'}</button>
                `;
            }
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        function saveItem(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());

            if(editingType.includes('Ruta')) {
                if(editingType==='crearRuta') {
                    const newId = rutasData.length ? Math.max(...rutasData.map(r=>r.id))+1 : 1;
                    rutasData.push({...data, id:newId, distancia:parseFloat(data.distancia), precio_base:parseFloat(data.precio_base)});
                } else {
                    const index = rutasData.findIndex(r => r.id===editingItem.id);
                    rutasData[index] = {...data, id:editingItem.id, distancia:parseFloat(data.distancia), precio_base:parseFloat(data.precio_base)};
                }
                loadRutasTable();
            }

            if(editingType.includes('Viaje')) {
                if(editingType==='crearViaje') {
                    const newId = viajesData.length ? Math.max(...viajesData.map(v=>v.id))+1 : 1;
                    viajesData.push({...data, id:newId});
                } else {
                    const index = viajesData.findIndex(v => v.id===editingItem.id);
                    viajesData[index] = {...data, id:editingItem.id};
                }
                loadViajesTable();
            }

            closeModal();
        }

        function deleteItem(tipo, id) {
            if(confirm('¬øDesea eliminar este registro?')) {
                if(tipo==='ruta') rutasData = rutasData.filter(r => r.id!==id);
                if(tipo==='viaje') viajesData = viajesData.filter(v => v.id!==id);
                loadRutasTable();
                loadViajesTable();
            }
        }

        function logout() {
            localStorage.removeItem('usuario');
            localStorage.removeItem('token');
            window.location.href = '/login';
        }

        loadRutasTable();
        loadViajesTable();
    </script>
</body>
</html>